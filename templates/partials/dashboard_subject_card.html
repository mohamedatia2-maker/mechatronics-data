{% load static resource_filters %}
<!-- Zen Portal Horizontal Subject Shelf - Redesigned Bento Style -->
<div id="card-{{ subject.id }}"
    class="subject-card group relative bg-white/60 dark:bg-charcoal/40 backdrop-blur-2xl border border-gray-100 dark:border-white/5 rounded-[2rem] lg:rounded-[2.5rem] shadow-xl hover:shadow-[0_20px_60px_rgba(0,0,0,0.1)] dark:hover:shadow-[0_20px_60px_rgba(0,0,0,0.4)] transition-all duration-700 overflow-hidden cursor-pointer"
    onclick="toggleSubjectCard('{{ subject.id }}')">

    <div class="flex flex-col lg:flex-row h-full">
        <!-- Left Identity Sidebar (Always Visible) -->
        <div
            class="lg:w-80 shrink-0 relative overflow-hidden p-6 lg:p-10 flex flex-col justify-between border-b lg:border-b-0 lg:border-r border-gray-100 dark:border-white/5 transition-all duration-700">
            <!-- Dynamic Gradient Background -->
            <div class="absolute inset-0 opacity-10 dark:opacity-20 transition-transform duration-1000 group-hover:scale-110
                {% if forloop.counter|divisibleby:5 %}bg-gradient-to-br from-amber-500 to-orange-600
                {% elif forloop.counter|divisibleby:4 %}bg-gradient-to-br from-violet-600 to-purple-700
                {% elif forloop.counter|divisibleby:3 %}bg-gradient-to-br from-rose-600 to-orange-700
                {% elif forloop.counter|divisibleby:2 %}bg-gradient-to-br from-emerald-600 to-teal-700
                {% else %}bg-gradient-to-br from-blue-600 to-indigo-700{% endif %}"></div>

            <div class="relative z-10">
                <!-- Course Specific Icon Container -->
                <div class="w-14 h-14 lg:w-20 lg:h-20 rounded-2xl lg:rounded-[1.75rem] mb-6 lg:mb-8 flex items-center justify-center text-3xl lg:text-4xl shadow-xl transform transition-all duration-700 group-hover:scale-110 group-hover:rotate-3
                    {% if forloop.counter|divisibleby:5 %}bg-white/95 text-amber-600 shadow-amber-500/10 dark:bg-charcoal/90 dark:text-amber-400
                    {% elif forloop.counter|divisibleby:4 %}bg-white/95 text-violet-600 shadow-violet-500/10 dark:bg-charcoal/90 dark:text-violet-400
                    {% elif forloop.counter|divisibleby:3 %}bg-white/95 text-rose-600 shadow-rose-500/10 dark:bg-charcoal/90 dark:text-rose-400
                    {% elif forloop.counter|divisibleby:2 %}bg-white/95 text-emerald-600 shadow-emerald-500/10 dark:bg-charcoal/90 dark:text-emerald-400
                    {% else %}bg-white/95 text-blue-600 shadow-blue-500/10 dark:bg-charcoal/90 dark:text-blue-400{% endif %}
                    border border-white/40 dark:border-white/10 backdrop-blur-sm">
                    <i class="{{ subject.name|subject_icon }}"></i>
                </div>

                <h3
                    class="text-2xl lg:text-3xl font-black text-charcoal dark:text-white font-['Outfit'] leading-tight mb-2 lg:mb-3">
                    {{ subject.name }}
                </h3>
                <p
                    class="text-[9px] lg:text-[10px] font-black uppercase tracking-[0.2em] lg:tracking-[0.3em] text-gray-400 dark:text-gray-500">
                    {{ subject.pdf_resources.count }} <span class="lang-en">Academic Resources</span><span
                        class="lang-ar">مصادر دراسية</span>
                </p>
            </div>

            <div class="relative z-10 mt-6 lg:mt-10">
                <div class="flex items-center justify-between mb-2 lg:mb-3">
                    <span class="text-[9px] lg:text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                        <span class="lang-en">Mastery</span><span class="lang-ar">الإتقان</span>
                    </span>
                    <span class="text-[10px] lg:text-xs font-black text-forest-green dark:text-emerald-400">0%</span>
                </div>
                <div class="h-1.5 lg:h-2 w-full bg-gray-100 dark:bg-white/5 rounded-full overflow-hidden">
                    <div
                        class="h-full bg-forest-green dark:bg-emerald-500 w-0 transition-all duration-1000 group-hover:w-[15%] rounded-full shadow-[0_0_15px_rgba(34,197,94,0.3)]">
                    </div>
                </div>
            </div>

            <!-- Expansion Hint -->
            <div
                class="absolute bottom-4 right-4 text-gray-300 dark:text-gray-600 transform transition-transform duration-700 group-[.is-open]:rotate-180 hidden lg:block">
                <i class="fas fa-chevron-right text-sm"></i>
            </div>
            <div
                class="absolute bottom-4 right-4 text-gray-300 dark:text-gray-600 transform transition-transform duration-700 group-[.is-open]:rotate-180 lg:hidden">
                <i class="fas fa-chevron-down text-sm"></i>
            </div>
        </div>

        <!-- Right Content Area: Bento Material Grid (Collapsible) -->
        <div id="content-{{ subject.id }}"
            class="subject-content flex-grow max-h-0 lg:max-h-full lg:max-w-0 overflow-hidden transition-all duration-700 opacity-0 bg-gray-50/30 dark:bg-white/5">
            <div class="p-6 lg:p-10 pb-20 lg:pb-10">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 lg:gap-6">
                    {% for category in categories %}
                    {% if subject.name == 'Production Technology' %}
                    {% if category == 'Midterm' %}
                    {% with count=subject.midterm_count|add:subject.final_count %}
                    {% include "partials/dashboard_subject_card_item.html" with category='Exams' override_count=count %}
                    {% endwith %}
                    {% elif category == 'Final' %}
                    {# Skip Final for Prod Tech #}
                    {% elif category == 'Workshops' %}
                    {% include "partials/dashboard_subject_card_item.html" %}
                    {% else %}
                    {% include "partials/dashboard_subject_card_item.html" %}
                    {% endif %}
                    {% else %}
                    {% if category == 'Workshops' %}
                    {% if subject.workshop_count > 0 %}
                    {% include "partials/dashboard_subject_card_item.html" %}
                    {% endif %}
                    {% else %}
                    {% include "partials/dashboard_subject_card_item.html" %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Horizontal expansion only on LG screens */
    @media (min-width: 1024px) {
        .subject-content.active {
            max-width: 1500px !important;
            opacity: 1 !important;
        }
    }

    /* Vertical expansion on smaller screens */
    @media (max-width: 1023px) {
        .subject-content.active {
            max-height: 2000px !important;
            opacity: 1 !important;
        }
    }
</style>